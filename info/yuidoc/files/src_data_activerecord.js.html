<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>src&#x2F;data&#x2F;activerecord.js</title>
    <link rel="stylesheet" href="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;3.8.0&#x2F;build&#x2F;cssgrids&#x2F;cssgrids-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="..&#x2F;assets/css/main.css" id="site_styles">
    <link rel="shortcut icon" type="image/png" href="..&#x2F;assets/favicon.png">
    <script src="http:&#x2F;&#x2F;yui.yahooapis.com&#x2F;combo?3.8.0&#x2F;build&#x2F;yui&#x2F;yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
            
                <h1><img src="..&#x2F;assets/css/logo.png" title=""></h1>
            
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: </em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
    <h2 class="off-left">APIs</h2>
    <div id="api-tabview" class="tabview">
        <ul class="tabs">
            <li><a href="#api-classes">Classes</a></li>
            <li><a href="#api-modules">Modules</a></li>
        </ul>

        <div id="api-tabview-filter">
            <input type="search" id="api-filter" placeholder="Type to filter APIs">
        </div>

        <div id="api-tabview-panel">
            <ul id="api-classes" class="apis classes">
            
                <li><a href="..&#x2F;classes/Sway.html">Sway</a></li>
            
                <li><a href="..&#x2F;classes/Sway.data.ActiveRecord.html">Sway.data.ActiveRecord</a></li>
            
                <li><a href="..&#x2F;classes/Sway.data.Field.html">Sway.data.Field</a></li>
            
                <li><a href="..&#x2F;classes/Sway.data.Model.html">Sway.data.Model</a></li>
            
                <li><a href="..&#x2F;classes/Sway.DI.html">Sway.DI</a></li>
            
                <li><a href="..&#x2F;classes/Sway.EventHub.html">Sway.EventHub</a></li>
            
                <li><a href="..&#x2F;classes/Sway.filter.Compress.html">Sway.filter.Compress</a></li>
            
                <li><a href="..&#x2F;classes/Sway.filter.Encrypt.html">Sway.filter.Encrypt</a></li>
            
                <li><a href="..&#x2F;classes/Sway.persistance.Cookie.html">Sway.persistance.Cookie</a></li>
            
                <li><a href="..&#x2F;classes/Sway.persistance.IndexedDb.html">Sway.persistance.IndexedDb</a></li>
            
                <li><a href="..&#x2F;classes/Sway.persistance.LocalStorage.html">Sway.persistance.LocalStorage</a></li>
            
            </ul>

            <ul id="api-modules" class="apis modules">
            
            </ul>
        </div>
    </div>
</div>

            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
        Show:
        <label for="api-show-inherited">
            <input type="checkbox" id="api-show-inherited" checked>
            Inherited
        </label>

        <label for="api-show-protected">
            <input type="checkbox" id="api-show-protected">
            Protected
        </label>

        <label for="api-show-private">
            <input type="checkbox" id="api-show-private">
            Private
        </label>
        <label for="api-show-deprecated">
            <input type="checkbox" id="api-show-deprecated">
            Deprecated
        </label>

    </div>


            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
                        <h1 class="file-heading">File: src&#x2F;data&#x2F;activerecord.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
&#x2F;&#x2F; Create the namespace -&gt; JS load order independent
window.Sway = window.Sway || {} ;
window.Sway.data = window.Sway.data || {} ;

(function(ns) {
    &quot;use strict&quot; ;

    var DEFAULTS = {
            STATE: {
                &#x2F;*
                 * @property STATE.TRANFORMED
                 * @static
                 *&#x2F;
                TRANSFORMED: 1
                &#x2F;*
                 * @property STATE.NORMAL
                 * @static
                 *&#x2F;
                , NORMAL: 0
            }
        }
        , statics = {
            &#x2F;*
            * TODO
            * @method find
            * @static
            * @param {Object} options
            *&#x2F;
            find: function(options) {

            }
            &#x2F;*
            * @method save
            * @static
            * @param {Object} options
            *&#x2F;
            , save: function(options) {
            }
        }
        &#x2F;**
         * The ActiveRecord class represents data-structures, like a database table. However, ActiveRecord is a special class, instead of
         * creating instances of itself, is create a new class of type {{#crossLink &quot;Sway.data.Model&quot;}}{{&#x2F;crossLink}}. ActiveRecord is a
         * blue print for all models it creates, providing them with functionality needed to perform CRUD-like tasks
         *
         *      var UserModel = new ActiveRecord( &#x27;User&#x27;, new WebSqlPersistance(&#x27;user-table&#x27;), [
         *                            new Field( {type: &#x27;TEXT&#x27;, key: &#x27;username&#x27;, friendlyName: &#x27;User name&#x27;})
         *                          , new Field( {type: &#x27;TEXT&#x27;, key: &#x27;password&#x27;, friendlyName: &#x27;Password&#x27;})
         *                          , new Field( {type: &#x27;DATE&#x27;, key: &#x27;birthday&#x27;, friendlyName: &#x27;Birthday&#x27;})
         *                      ]) ;
         *
         *
         * ActiveRecord needs the name of the model to be created, an object used to persist the data and finally a list of field
         * definitions.
         *
         * @class Sway.data.ActiveRecord
         * @constructor
         * @param {String} modelName name of the model
         * @param {Object}[persistence] object used for data persistance and lookups
         * @param {Array} [fieldList] list of fields
         *&#x2F;
       , ActiveRecord = function(modelName, persistance, fieldList ) {
            var i ;

           function Model(data, options) {                 &#x2F;&#x2F; define the model class&#x2F;function
                    if ( !options) {                                &#x2F;&#x2F; fix input
                        options = {} ;
                    }
                    this.__data        = {} ;                       &#x2F;&#x2F; the data object
                    this.__fields      = {} ;                       &#x2F;&#x2F; object holding the fields
                    this.__persistance = persistance ;              &#x2F;&#x2F; persistance layer
                    this.$className    = modelName ;                  &#x2F;&#x2F; name of the model
                    this.__state       = typeof(options.transformed) === &#x27;boolean&#x27; ? options.transformed : DEFAULTS.STATE.UNFILTERED ;  &#x2F;&#x2F; state of the record

                    Object.defineProperty(this, &#x27;__transform&#x27;, {    &#x2F;&#x2F; object used in fluent API
                        value: new Object({ self: this })
                        ,enumerable: false
                        ,writable: false
                        ,configurable: false
                    }) ;

                    for( i = 0; i &lt; fieldList.length; i++ ) {       &#x2F;&#x2F; add fields to this and
                        createProperty.call(this, fieldList[i], data) ;   &#x2F;&#x2F; populate this.fields
                    }
            }
            Model.prototype = this ; &#x2F;&#x2F; add function using prototype inheritance

            &#x2F;&#x2F; add static functions
            for( i in statics ) {
                Model[i] = statics[i] ;
            }

            &#x2F;&#x2F; add static properties
            for ( i in DEFAULTS.STATE ) {
                Model[i] = DEFAULTS.STATE[i] ;
            }

            return Model ;
        } ;

    &#x2F;*
     * Make fields accessible as normal properties of &#x27;this&#x27; and populate this.fields.
     * Now values can be set an accessed as follows
     *
     *    userRecord.username = &#x27;John&#x27; ;
     *    userRecord.transformed(false).password = &#x27;Secret&#x27; ;
     *&#x2F;
    function createProperty(field, data) {
        Object.defineProperty(this, field.key, {
            get: getValue.bind(this, field)
            , set: setValue.bind(this, field)
            ,enumerable: true
            ,configurable: true
        }) ;

        Object.defineProperty(this.__transform, field.key, {          &#x2F;&#x2F; create fluent api object
            get: getValue.bind(this, field)
            , set: setValue.bind(this, field)
            ,enumerable: true
            ,configurable: true
        }) ;

        this.__fields[field.key] = field ;
        &#x2F;&#x2F; if data is an active-record, its state is used so no transformations are required
        this.__data[field.key] = { value: data[field.key], state: (typeof(data.__state) === &#x27;boolean&#x27; ? data.__state: this.state) } ;
    }

    &#x2F;*
     * is called if a property is accessed (see createProperty)
     *&#x2F;
    function getValue(field, callback) {
        &#x2F;&#x2F; TODO take into account this.__transform
        return this.data[field.key]
    }

    &#x2F;*
     * is called when a property is set. Note that the context (this) in this function can be &#x27;this&#x27; or &#x27;this.transform&#x27;
     *&#x2F;
    function setValue(field, value) {
        var self = this ;
        &#x2F;&#x2F;if ( typeof(this.isTransformed === t)
        this.data[field.key] = value ;
    }

	ActiveRecord.prototype = {
        &#x2F;&#x2F; TODO: should not be lazy, or else you cannot use properties, because they need to be transformed :(
        &#x2F;**
         * set the a new state.
         * @param state
         * @param {Boolean} [isLazy=true] values are transformed into the new state when requested. If &lt;tt&gt;true, all
         * values are transformed immediately.
         * @param {Function} [callback] if &lt;tt&gt;isLazy&lt;&#x2F;tt&gt; is set to TRUE the callback is called when all values
         * are transformed.
         *&#x2F;
        setState: function(state, isLazy, callback) {
            &#x2F;&#x2F; TODO
            this.state = state ;
        }
        &#x2F;**
         * set the value for a specific field with a specific state. If called with the &lt;tt&gt;state&lt;&#x2F;tt&gt; left empty it behaves
         * identical to setting this value using the instance corresponding property
         *
         *          userRecord.username = &#x27;John&#x27;                &#x2F;&#x2F; or
         *          userRecord.setValue(&#x27;username&#x27;, &#x27;John&#x27;) ;
         *
         * @param {String} key
         * @param {String} value
         * @param {String} [state] one of the Model.STATEs. If empty, the data is expected to be in the state of the record
         *&#x2F;
        , setValue: function(key, value, state) {

        }
        &#x2F;**
         * Returns the value of a specific field. If called without a &lt;tt&gt;state&lt;&#x2F;tt&gt; defined, it behaves identical to
         * retrieving the value using the instance corresponding property
         *
         *          userRecord.username                        &#x2F;&#x2F; or
         *          userRecord.getValue(&#x27;username&#x27;) ;
         *&#x2F;
        &#x2F;&#x2F; only use this function if
        , getValue: function(key, state) {

        }

        , toJSON: function() { &#x2F;&#x2F; ale
            return {} ; &#x2F;&#x2F; TODO
        }

        , getSize: function(key) {
            var self = this._ar
                , size = 0
                , i ;

            if ( key ) {
                return self._field[self._fieldLookup[key]].field.getSize() ;
            }
            else {
                for( i = 0; i &lt; self._field.length; i++ ) {
                    size += self._field[i].field.getSize() ;
                }
            }
            return size ;
            &#x2F;*
            return (this.state == &quot;uncompressed&quot; ?
                        new Blob([this._inputStr], { type: &quot;text&#x2F;plain&quot;}) : this._zippedBlob
                   ).size ;
            *&#x2F;
        }
    } ;


	ns.ActiveRecord = ActiveRecord ;

})(window.Sway.data) ;

&#x2F;* Define the Model class here *&#x2F;

&#x2F;**
 * This is a virtual class and is created using {{#crossLink &quot;Sway.data.ActiveRecord&quot;}}{{&#x2F;crossLink}}. This dynamic class creation method
 * facilitates the creation of new classes fully configured with field definitions and a persistence layer at runtime. Theses instances
 * can directly save data
 *
 *     var userRecord = new User({username: &#x27;John&#x27;, password: &#x27;Secret&#x27;}) ;
 *     ....
 *     userRecord.save() ;
 *
 * All fields are accessible as a property of a record
 *
 *     var userRecord = new User() ;
 *     userRecord.username = &#x27;John&#x27; ;
 *     userRecord.password = &#x27;Secret&#x27; ;
 *
 * @class Sway.data.Model
 * @constructor
 * @param {Object|Model} [data] JSON data or a model instance to be cloned
 * @example
        var userRecord = new User({...}) ;
        var userRecord1 = new User(userRecord) ;
 *&#x2F;
&#x2F;**
 * TODO
 * @method save
 *
 *&#x2F;
&#x2F;**
 * This function should only be used if one or more fields use transformers.
 *
 * This function can be used as follows
 *
 *     userRecord = new User({username: &#x27;John&#x27;}) ;
 *     userRecord.transformed(false).password = &#x27;Secret&#x27; ;
 *
 *
 * @method transformed
 * @chainable
 * @param isTransformed
 * @returns {Object} special object which behaves identical to this, but its state equals &lt;tt&gt;isTransformed&lt;&#x2F;tt&gt;
 *&#x2F;
&#x2F;**
 * returns all the data in JSON format (unfiltered)
 * @method getToJSON
 * @param {String} key
 * @returns {Number}
 *&#x2F;
&#x2F;**
 * @method getSize
 * @param {Sting} key
 *&#x2F;
&#x2F;**
 *    User.find(
 *      {
 *           &#x27;username&#x27;:   &#x27;John&#x27;
 *           , &#x27;password&#x27;: &#x27;Secret&#x27;
 *      }, function(user) { ... } ) ;
 *
 * Or use a model instance for searching
 *
 *     User.find(userRecord, callbackFunc) ;
 *
 *
 *
 *
 *
 *           alert(&#x27;Welcome &#x27; + user.username + &#x27;! Your birthday is &#x27; + user.birthday) ;
 *           var cloneUser = new User(user) ;
 *           cloneUser.birthDay = new Date() ;              &#x2F;&#x2F; access field &#x27;birthday&#x27; as a property
 *           newUser.save() ;
 *       }
 *     ) ;
 *
 * Or simply create a new instance of a Model and use it for a search or save action
 *
 *      var userRecord = new User({ username: &#x27;John&#x27;, password: &#x27;Secret&#x27;}) ;
 *      User.find(userRecord, callback) ;
 *      &#x2F;&#x2F; or
 *      userRecord.save() ;
 * @method find
 * @static
 * @param {Object} options
 *&#x2F;
&#x2F;**
 * @method save
 * @static
 * @param {Object} options
 *&#x2F;
&#x2F;**
 * @property STATE.TRANFORMED
 * @static
 *&#x2F;
&#x2F;**
 * @property STATE.NORMAL
 * @static
 *&#x2F;

    </pre>
</div>

                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="..&#x2F;assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="..&#x2F;assets/js/yui-prettify.js"></script>
<script src="..&#x2F;assets/../api.js"></script>
<script src="..&#x2F;assets/js/api-filter.js"></script>
<script src="..&#x2F;assets/js/api-list.js"></script>
<script src="..&#x2F;assets/js/api-search.js"></script>
<script src="..&#x2F;assets/js/apidocs.js"></script>
</body>
</html>
