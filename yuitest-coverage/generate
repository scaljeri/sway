var page = require('webpage').create()
    , file = "http://localhost/~QNH/zipped" + "/SpecRunnerCoverage.html" ;

/*
page.onConsoleMessage = function (msg) {
    console.log(msg);
};
*/

page.open(file, function (status) {
    setInterval(
        function() {
       	    var isReady = page.evaluate(function () {
                return window.IS_READY;
            });
            if ( isReady ) {
            	var json = page.evaluate(function () {
               	    return window._yuitest_coverage;
                });
                console.log(JSON.stringify(json));
                phantom.exit();
            }
    	}, 100) ;

    // just to make sure it will stop if something went wrong!
    setTimeout(function() { 
        console.error('Jasmine never finished!!');
        phantom.exit();
    }, 10000) ;
});
